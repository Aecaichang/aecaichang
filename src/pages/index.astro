---
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import { getCollection } from 'astro:content';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';

const posts = (await getCollection('blog'))
  .map((post) => ({
    id: post.id,
    title: post.data.title,
    description: post.data.description,
    date: post.data.pubDate,
    imageUrl: typeof post.data.heroImage === 'string' ? post.data.heroImage : post.data.heroImage?.src,
    imageAlt: post.data.heroImageAlt || post.data.title
  }))
  .sort((a, b) => b.date.valueOf() - a.date.valueOf());
---

<!doctype html>
<html lang="th">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
  </head>
  <body>
    <Header />
    <main>
      <h1>aecaichang Blog</h1>
      <p>
        พื้นที่สำหรับเล่าเรื่อง แชร์ประสบการณ์ และบันทึกสิ่งที่เรียนรู้จากชีวิตและการทำงาน
      </p>
      <section class="post-grid">
        {posts.map((post) => (
          <article class="post-card">
            {post.imageUrl && <img src={post.imageUrl} alt={post.imageAlt} loading="lazy" />}
            <div class="post-body">
              <p class="post-date">
                {post.date.toLocaleDateString('th-TH', {
                  day: 'numeric',
                  month: 'long',
                  year: 'numeric'
                })}
              </p>
              <h2>
                <a href={`/blog/${post.id}/`}>{post.title}</a>
              </h2>
              <p>{post.description}</p>
            </div>
          </article>
        ))}
      </section>
    </main>
    <Footer />
  </body>
</html>

<style>
  .post-grid {
    margin-top: 2rem;
    display: grid;
    gap: 1.25rem;
  }

  .post-card {
    border: 1px solid rgb(var(--gray-light));
    border-radius: 14px;
    overflow: hidden;
    background: white;
    box-shadow: 0 4px 18px rgba(var(--gray), 12%);
    position: relative;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .post-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(var(--gray), 20%);
  }

  .post-card img {
    width: 100%;
    height: 220px;
    object-fit: cover;
    border-radius: 0;
    display: block;
  }

  .post-body {
    padding: 1rem 1.1rem 1.25rem;
  }

  .post-date {
    margin: 0 0 0.35rem;
    color: rgb(var(--gray));
    font-size: 0.9rem;
  }

  .post-body h2 {
    margin: 0 0 0.4rem;
    font-size: 1.35rem;
  }

  .post-body h2 a {
    color: rgb(var(--black));
    text-decoration: none;
  }

  .post-body h2 a::after {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
  }

  .post-body p {
    margin: 0;
  }
</style>
